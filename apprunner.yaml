version: 1.0
runtime: nodejs18
build:
  commands:
    pre-build:
      - echo "Starting installation process..."
      - apt-get update || echo "Update failed with exit code $?"
      - apt-get install -y python3.10 python3-pip redis-server || echo "Install failed with exit code $?"
      - python3.10 --version || echo "Python version check failed with exit code $?"
      - redis-server --version || echo "Redis version check failed with exit code $?"
    build:
      - npm install
run:
  command: |
    service redis-server start
    sleep 5
    redis-cli ping
    node index.js
  network:
    port: 8080
  env:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "8080"
    - name: AWS_REGION
      value: "us-east-2"
    - name: DEBUG_SECRETS
      value: "true"
    - name: PYTHON_VERSION
      value: "3.10.12"
  secrets:
    - name: AWS_SECRETS_ARN
      value-from: "arn:aws:secretsmanager:us-east-2:194722409366:secret:TrackFusionWeb-API-SECRET-oJ1QWt"