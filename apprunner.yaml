version: 1.0
runtime: python3
build:
  commands:
    build:
      - python3.10 -m ensurepip --upgrade
      - python3.10 -m pip install -r requirements.txt
      - curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
      - apt-get install -y nodejs
      - npm install
  env:
    - name: NODE_ENV
      value: "production"
run:
  pre-run:
    - apt-get update
    - apt-get install -y redis-server
    - service redis-server start
  command: node index.js
  network:
    port: 8080
  env:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "8080"
    - name: AWS_REGION
      value: "us-east-2"
    - name: DEBUG_SECRETS
      value: "true"
  secrets:
    - name: AWS_SECRETS_ARN
      value-from: "arn:aws:secretsmanager:us-east-2:194722409366:secret:TrackFusionWeb-API-SECRET-oJ1QWt"